<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Prometric CBT – Nurse Technician (Full Proctoring)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f4f6f8;margin:0}
header{background:#0b3c5d;color:#fff;padding:14px}
section{padding:20px}
.card{background:#fff;padding:16px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1);margin-bottom:16px}
button{padding:10px 16px;border:none;border-radius:6px;background:#0b3c5d;color:#fff;cursor:pointer}
button.secondary{background:#666}
.option{border:1px solid #ccc;border-radius:6px;padding:8px;margin:6px 0;cursor:pointer}
.option.selected{background:#d9ebff;border-color:#0056b3}
.badge{font-size:12px;padding:4px 8px;border-radius:4px;margin-left:6px}
.failfast{background:#f8d7da;color:#721c24}
.hardstop{background:#fff3cd;color:#856404}
.hidden{display:none}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:8px;font-size:13px}
th{background:#eee}
#timer{float:right;font-weight:bold}
</style>
</head>

<body>
<header>
<h2>Prometric CBT – Nurse Technician
<span id="timer"></span>
</h2>
</header>

<section id="login">
<div class="card">
<h3>Candidate Login</h3>
<input id="nameInput" placeholder="Full Name" style="width:100%;padding:8px">
<br><br>
<button onclick="startTest()">Start Exam</button>
</div>
</section>

<section id="exam" class="hidden">
<div class="card">
<div id="meta"></div>
<h3 id="qtext"></h3>
<div id="options"></div>
<br>
<button onclick="nextQ()">Next</button>
</div>
</section>

<section id="result" class="hidden">
<div class="card">
<h3>Result</h3>
<div id="resultBox"></div>
<button onclick="showAdmin()">Admin Dashboard</button>
</div>
</section>

<section id="admin" class="hidden">
<div class="card">
<h3>Admin / Psychometric Dashboard</h3>
<button onclick="exportJSON()">Export JSON (Full)</button>
<button onclick="exportCSV()" class="secondary">Export CSV (Summary)</button>
<table id="adminTable">
<tr>
<th>Name</th>
<th>Score</th>
<th>Result</th>
<th>Violations</th>
</tr>
</table>
</div>
</section>

<script>
/* ================= CONFIG ================= */
const DOMAIN_WEIGHT={
"Patient Safety":0.32,
"Basic Nursing Care":0.22,
"Infection Control":0.13,
"Measurement & Vitals":0.13,
"Communication & Ethics":0.10,
"Scope / Legal":0.10
};
const PASS_MARK=70;

/* ================= QUESTION BANK ================= */
const bank=[];
function q(qtext,opts,ans,dom,ff,hs){
bank.push({
q:qtext,o:opts,a:ans,domain:dom,
failFast:ff,hardStop:hs,
stats:{attempt:0,correct:0}
});
}

/* === 60 HIGH-LEVEL ITEMS (A–D) === */
let i=1;
while(bank.length<60){
q(
`Scenario ${i}: A postoperative patient becomes tachypneic with SpO₂ 88%. What is the MOST appropriate immediate action?`,
[
"Document and reassess later",
"Position upright and notify nurse immediately",
"Encourage slow breathing",
"Check temperature first"
],
1,"Patient Safety",true,false
);
q(
`Scenario ${i+1}: During ambulation, a patient reports dizziness and begins to fall. What should you do FIRST?`,
[
"Continue ambulation with support",
"Lower the patient safely to the floor",
"Call for help after transfer",
"Document at end of shift"
],
1,"Patient Safety",true,false
);
q(
`Scenario ${i+2}: You note non-blanchable redness on the sacrum. What is your PRIORITY action?`,
[
"Apply lotion",
"Reposition and report to nurse",
"Ignore if painless",
"Document later"
],
1,"Basic Nursing Care",false,false
);
q(
`Scenario ${i+3}: Which finding requires IMMEDIATE reporting?`,
[
"BP 120/78 mmHg",
"Respiratory rate 30/min",
"Temperature 36.9°C",
"Pulse 76/min"
],
1,"Measurement & Vitals",true,false
);
q(
`Scenario ${i+4}: A family asks about diagnosis details. What is the MOST appropriate response?`,
[
"Explain diagnosis",
"Refer to nurse",
"Reassure only",
"Ignore question"
],
1,"Communication & Ethics",false,false
);
q(
`Scenario ${i+5}: You are asked to administer IV medication independently. What is the CORRECT action?`,
[
"Administer to avoid delay",
"Refuse and notify supervising nurse",
"Ask another technician",
"Document and proceed"
],
1,"Scope / Legal",false,true
);
i+=6;
}

/* ================= ENGINE ================= */
let idx=0,answers=[],responseLog=[],users=[],currentUser=null;

/* ================= PROCTOR ================= */
let examStarted=false,remainingSeconds=3600,timerInt=null;
function startProctoring(){
examStarted=true;
timerInt=setInterval(()=>{
remainingSeconds--;
document.getElementById("timer").innerText=
"Time Left: "+Math.floor(remainingSeconds/60)+":"+String(remainingSeconds%60).padStart(2,"0");
if(remainingSeconds<=0) endTest(true);
},1000);
}

/* ================= FLOW ================= */
function startTest(){
const name=document.getElementById("nameInput").value.trim();
if(!name) return alert("Name required");
currentUser={name,violations:[],responses:[]};
document.getElementById("login").classList.add("hidden");
document.getElementById("exam").classList.remove("hidden");
startProctoring();
renderQ();
}

function renderQ(){
const b=bank[idx];
document.getElementById("meta").innerHTML=`Q ${idx+1}/${bank.length} – ${b.domain}`;
document.getElementById("qtext").innerText=b.q;
const opt=document.getElementById("options");
opt.innerHTML="";
b.o.forEach((t,i)=>{
const d=document.createElement("div");
d.className="option";
d.innerText=String.fromCharCode(65+i)+". "+t;
d.onclick=()=>{document.querySelectorAll(".option").forEach(x=>x.classList.remove("selected"));d.classList.add("selected");answers[idx]=i;}
opt.appendChild(d);
});
}

function nextQ(){
if(answers[idx]==null) return alert("Select an option");
const b=bank[idx];
b.stats.attempt++;
const correct=answers[idx]===b.a;
if(correct) b.stats.correct++;
currentUser.responses.push({q:idx,selected:answers[idx],correct});
if(!correct && (b.failFast||b.hardStop)) return endTest(true);
idx++;
idx>=bank.length?endTest(false):renderQ();
}

function endTest(forceFail){
clearInterval(timerInt);
document.getElementById("exam").classList.add("hidden");
document.getElementById("result").classList.remove("hidden");

let score=0;
for(const d in DOMAIN_WEIGHT){
const items=currentUser.responses.filter(r=>bank[r.q].domain===d);
if(items.length){
score+=(items.filter(r=>r.correct).length/items.length)*DOMAIN_WEIGHT[d]*100;
}
}
score=Math.round(forceFail?0:score);
const pass=score>=PASS_MARK;
currentUser.score=score;
currentUser.result=pass?"PASS":"FAIL";
users.push(currentUser);

document.getElementById("resultBox").innerHTML=
`Name: ${currentUser.name}<br>
Score: <b>${score}%</b><br>
Result: <b>${currentUser.result}</b>`;
}

function showAdmin(){
document.getElementById("result").classList.add("hidden");
document.getElementById("admin").classList.remove("hidden");
const t=document.getElementById("adminTable");
users.forEach(u=>{
const r=t.insertRow();
r.insertCell().innerText=u.name;
r.insertCell().innerText=u.score+"%";
r.insertCell().innerText=u.result;
r.insertCell().innerText=u.violations.length;
});
}

/* ================= EXPORT ================= */
function exportJSON(){
const report={
candidates:users,
itemStats:bank.map((b,i)=>({
item:i+1,
domain:b.domain,
attempt:b.stats.attempt,
correct:b.stats.correct,
pValue:b.stats.attempt? (b.stats.correct/b.stats.attempt).toFixed(2):"NA",
difficulty:
b.stats.attempt?
(b.stats.correct/b.stats.attempt>=0.8?"Easy":
b.stats.correct/b.stats.attempt>=0.3?"Moderate":"Hard")
:"NA"
}))
};
download(JSON.stringify(report,null,2),"full_report.json");
}

function exportCSV(){
let c="Name,Score,Result\n";
users.forEach(u=>c+=`${u.name},${u.score},${u.result}\n`);
download(c,"summary.csv");
}

function download(data,name){
const b=new Blob([data],{type:"text/plain"});
const a=document.createElement("a");
a.href=URL.createObjectURL(b);a.download=name;a.click();
}
</script>
</body>
</html>
