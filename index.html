<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Prometric CBT – Nurse Technician (Full Proctoring)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{font-family:Arial;background:#f4f6f8;margin:0}
header{background:#0b3c5d;color:#fff;padding:14px}
section{padding:20px}
.card{background:#fff;padding:16px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1);margin-bottom:16px}
button{padding:10px 16px;border:none;border-radius:6px;background:#0b3c5d;color:#fff;cursor:pointer}
button.secondary{background:#666}
.option{border:1px solid #ccc;border-radius:6px;padding:8px;margin:6px 0;cursor:pointer}
.option.selected{background:#d9ebff;border-color:#0056b3}
.badge{font-size:12px;padding:4px 8px;border-radius:4px;margin-left:6px}
.failfast{background:#f8d7da;color:#721c24}
.hardstop{background:#fff3cd;color:#856404}
.hidden{display:none}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:8px;font-size:13px}
th{background:#eee}
#timer{float:right;font-weight:bold}
</style>
</head>

<body>
<header>
<h2>Prometric CBT – Nurse Technician (Full Proctoring)
<span id="timer"></span>
</h2>
</header>

<section id="login">
<div class="card">
<h3>Candidate Login</h3>
<input id="nameInput" placeholder="Full Name" style="width:100%;padding:8px">
<br><br>
<button onclick="startTest()">Start Exam</button>
</div>
</section>

<section id="exam" class="hidden">
<div class="card">
<div id="meta"></div>
<h3 id="qtext"></h3>
<div id="options"></div>
<br>
<button onclick="nextQ()">Next</button>
</div>
</section>

<section id="result" class="hidden">
<div class="card">
<h3>Result</h3>
<div id="resultBox"></div>
<button onclick="showAdmin()">Admin Dashboard</button>
</div>
</section>

<section id="admin" class="hidden">
<div class="card">
<h3>Admin / Proctor Dashboard</h3>
<button onclick="exportJSON()">Export JSON</button>
<button onclick="exportCSV()" class="secondary">Export CSV</button>
<table id="adminTable">
<tr>
<th>Name</th>
<th>Score</th>
<th>Result</th>
<th>Violations</th>
</tr>
</table>
</div>
</section>

<script>
/* ================= CONFIG ================= */
const DOMAIN_WEIGHT={
"Patient Safety":0.32,
"Basic Nursing Care":0.22,
"Infection Control":0.13,
"Measurement & Vitals":0.13,
"Communication & Ethics":0.10,
"Scope / Legal":0.10
};
const PASS_MARK=70;

/* ================= QUESTION BANK ================= */
const bank=[];
function q(qtext,opts,ans,dom,ff,hs){
bank.push({q:qtext,o:opts,a:ans,domain:dom,failFast:ff,hardStop:hs});
}

/* ================= 60 HIGH-LEVEL MCQ (A–D ONLY) ================= */
let n=1;
while(bank.length<60){
q(
`Scenario ${n}: A postoperative patient suddenly becomes anxious, tachypneic, and SpO₂ drops to 88%. What is the MOST appropriate immediate action?`,
[
"Document the finding and reassess in 30 minutes",
"Position the patient upright and notify the nurse immediately",
"Encourage the patient to relax and breathe slowly",
"Check temperature before taking further action"
],
1,
"Patient Safety",
true,
false
);

q(
`Scenario ${n+1}: During ambulation, a patient reports dizziness and begins to lose balance. What should you do FIRST?`,
[
"Support the patient and continue ambulation",
"Lower the patient safely to the floor",
"Call for assistance after completing the transfer",
"Document the incident at end of shift"
],
1,
"Patient Safety",
true,
false
);

q(
`Scenario ${n+2}: While providing hygiene care, you observe non-blanchable redness over the sacral area. What is your PRIORITY action?`,
[
"Apply moisturizing lotion",
"Reposition the patient and report to the nurse",
"Ignore since the patient reports no pain",
"Document the finding later"
],
1,
"Basic Nursing Care",
false,
false
);

q(
`Scenario ${n+3}: After removing gloves following patient care, what is the REQUIRED next action?`,
[
"Dispose of linen",
"Perform hand hygiene",
"Leave the room immediately",
"Remove gown"
],
1,
"Infection Control",
false,
false
);

q(
`Scenario ${n+4}: Which vital sign finding requires IMMEDIATE reporting?`,
[
"Blood pressure 118/76 mmHg",
"Respiratory rate 30/min",
"Temperature 36.8°C",
"Pulse 74/min"
],
1,
"Measurement & Vitals",
true,
false
);

q(
`Scenario ${n+5}: A family member asks you about the patient’s diagnosis. What is the MOST appropriate response?`,
[
"Explain the diagnosis using simple terms",
"State you are not permitted to discuss and will notify the nurse",
"Provide reassurance without answering the question",
"Ignore the question"
],
1,
"Communication & Ethics",
false,
false
);

q(
`Scenario ${n+6}: You are instructed to independently administer IV medication due to staff shortage. What is the CORRECT action?`,
[
"Administer the medication to avoid delay",
"Refuse and immediately notify the supervising nurse",
"Ask another technician for guidance",
"Document the instruction and proceed"
],
1,
"Scope / Legal",
false,
true
);

n+=7;
}

/* ================= ENGINE ================= */
let idx=0,answers=[],responseLog=[],users=[],currentUser=null;

/* ================= HARDENED PROCTOR ================= */
let examStarted=false;
let blurCount=0;
const maxBlur=2;
let remainingSeconds=60*60;
let timerInt=null;

function startProctoring(){
examStarted=true;
timerInt=setInterval(()=>{
remainingSeconds--;
document.getElementById("timer").innerText=
" | Time Left: "+Math.floor(remainingSeconds/60)+":"+String(remainingSeconds%60).padStart(2,"0");
if(remainingSeconds<=0){
registerViolation("TIME_EXPIRED");
endTest(true);
}
},1000);

document.addEventListener("visibilitychange",()=>{
if(document.hidden && examStarted){
registerViolation("TAB_SWITCH");
}
});

window.addEventListener("blur",()=>{
if(examStarted){
blurCount++;
registerViolation("WINDOW_BLUR");
if(blurCount>maxBlur){
registerViolation("FORCE_TERMINATION");
endTest(true);
}
}
});

document.addEventListener("contextmenu",e=>{
if(examStarted){e.preventDefault();registerViolation("RIGHT_CLICK");}
});

document.addEventListener("keydown",e=>{
if(!examStarted) return;
if((e.ctrlKey && ["c","v","x"].includes(e.key.toLowerCase())) || e.key==="PrintScreen"){
e.preventDefault();
registerViolation("KEYBOARD_BLOCKED");
}
});
}

function registerViolation(type){
currentUser.violations.push(type+" @ "+new Date().toISOString());
}

/* ================= FLOW ================= */
function startTest(){
const name=document.getElementById("nameInput").value.trim();
if(!name){alert("Name required");return;}
currentUser={name,violations:[]};
document.getElementById("login").classList.add("hidden");
document.getElementById("exam").classList.remove("hidden");
startProctoring();
renderQ();
}

function renderQ(){
const b=bank[idx];
document.getElementById("meta").innerHTML=
`Q ${idx+1}/${bank.length} – ${b.domain}
${b.failFast?'<span class="badge failfast">FAIL-FAST</span>':''}
${b.hardStop?'<span class="badge hardstop">HARD-STOP</span>':''}`;
document.getElementById("qtext").innerText=b.q;
const opt=document.getElementById("options");
opt.innerHTML="";
b.o.forEach((t,i)=>{
const d=document.createElement("div");
d.className="option";
d.innerText=String.fromCharCode(65+i)+". "+t;
d.onclick=()=>{document.querySelectorAll(".option").forEach(x=>x.classList.remove("selected"));d.classList.add("selected");answers[idx]=i;}
opt.appendChild(d);
});
}

function nextQ(){
if(answers[idx]==null){alert("Select an option");return;}
const b=bank[idx];
const correct=answers[idx]===b.a;
responseLog.push({domain:b.domain,correct});
if(!correct && (b.failFast||b.hardStop)){
registerViolation("CRITICAL_ERROR_Q"+(idx+1));
endTest(true);return;
}
idx++;
idx>=bank.length?endTest(false):renderQ();
}

function endTest(forceFail){
examStarted=false;
clearInterval(timerInt);
document.getElementById("exam").classList.add("hidden");
document.getElementById("result").classList.remove("hidden");

let score=0;
for(const d in DOMAIN_WEIGHT){
const items=responseLog.filter(r=>r.domain===d);
if(items.length){
score+=(items.filter(r=>r.correct).length/items.length)*DOMAIN_WEIGHT[d]*100;
}
}
score=Math.round(forceFail?0:score);
const pass=score>=PASS_MARK && currentUser.violations.length===0;
currentUser.score=score;
currentUser.result=pass?"PASS":"FAIL";
users.push(currentUser);

document.getElementById("resultBox").innerHTML=
`Name: ${currentUser.name}<br>
Score: <b>${score}%</b><br>
Result: <b style="color:${pass?'green':'red'}">${currentUser.result}</b><br>
Violations: ${currentUser.violations.length}`;
}
</script>
</body>
</html>
